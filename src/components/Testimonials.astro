---
interface Testimonial {
	quote: string;
	author: string;
	role?: string;
	avatar?: string;
}

import { getCollection } from 'astro:content';

interface Props {
	eyebrow?: string;
	title?: string;
	testimonials?: Testimonial[];
}

const { eyebrow, title, testimonials } = Astro.props;

let items: Testimonial[] = testimonials ?? [];

if (!testimonials) {
	const entries = await getCollection('testimonials');
	items = entries.length === 1 && Array.isArray(entries[0].data)
		? entries[0].data as Testimonial[]
		: entries.map((e) => e.data as Testimonial);
}
---

<section class="grid gap-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
  <div class="rounded-xl p-5 md:p-10 flex h-full flex-col justify-between gap-5 overflow-visible bg-[var(--color-brand-green)]">
    {eyebrow && <p class="text-sm font-semibold uppercase tracking-widest text-[var(--color-off-black)]/60 m-0">{eyebrow}</p>}
    {title && <h2 class="text-2xl leading-tight antialiased font-bold m-0">{title}</h2>}
    <p class="antialiased mt-auto text-[var(--color-off-black)]/70">Lo que dicen nuestros participantes sobre la <span class="whitespace-nowrap font-bold">OMM</span></p>
  </div>
  {items.map((t) => (
    <article class="rounded-2xl bg-[var(--color-brand-pink)] flex flex-col w-full h-full p-5 md:p-10">
      <h3 class="mb-5 text-xl leading-tight font-bold m-0">"{t.quote.slice(0, 60)}..."</h3>
      <p class="mt-auto text-sm text-[var(--color-off-black)]/80">{t.quote}</p>
      <footer class="mt-5 flex items-center justify-between">
        <span class="inline-flex items-center gap-2 bg-white/90 rounded-full text-[var(--color-off-black)] px-3 py-1 text-sm font-semibold">
          {t.author}
        </span>
        {t.role && <span class="text-xs text-[var(--color-off-black)]/60">{t.role}</span>}
      </footer>
    </article>
  ))}
</section>
